Voici une version **plus concise et structurée** du PRD, intégrant le triage physique comme fonctionnalité centrale.

# PRD – Codebase Hub  
**Version** : 1.1 (focus triage)  
**Date** : 15 janvier 2026  
**Objectif** : Centraliser, organiser physiquement et synchroniser une codebase locale (Windows/WSL) + GitHub

## 1. Portée v1.1

**In**  
- CRUD repos locaux & GitHub  
- Scan répertoires locaux → DB  
- Sync GitHub (pull auto + alertes)  
- **Triage & déplacement physique thématique** (cœur v1.1)  
- Recherche simple + chat basique  
- Backups sélectifs (par repo / thème)  
- Sync status multi-devices (via DB partagée)

**Out (v1)**  
- Multi-utilisateurs  
- Autres VCS  
- LLM avancé dans le chat  
- Mobile

## 2. Fonctionnalités principales

### 2.1 Configuration de base
- Répertoires à scanner (multiples, Windows + WSL)  
- Racine organisation physique : ex. `D:\Codebase\themes`  
- Liste thèmes personnalisables (CRUD UI) : nextjs, python-ds, archived, experiments, etc.

### 2.2 Scan & Triage (flux principal)

1. **Scan**  
   - Détecte dossiers `.git` dans répertoires configurés  
   - Met à jour DB : path origine, remote URL, SHA, etc.

2. **Triage** (automatique ou manuel)  
   - Pour chaque repo non organisé :  
     → Suggestions de thème (GitHub topics + package.json + heuristiques simples)  
   - UI : wizard batch  
     - Thème suggéré + boutons : Accepter / Choisir autre / Laisser / Ignorer  
     - Actions batch + dry-run  
   - Déplacement physique sécurisé :  
     - fs.rename async  
     - Backup temp avant move  
     - Gestion conflits (suffix -2)  
     - Alerte si dirty (proposer stash/commit)

3. **Mise à jour DB**  
   - `physicalPath`  
   - `theme`  
   - `triageStatus` : pending / manual / auto / ignored  
   - `triageDate`

### 2.3 Dashboard & UI clés
- Liste repos : colonne theme, physicalPath, sync status, triage status  
- Badge « X repos en attente de triage »  
- Page « Organisation » :  
  - Arborescence actuelle vs proposée  
  - Filtres : non triés / par thème  
- Boutons globaux : Scan now, Trier en attente, Backup sélection

### 2.4 Chat & Recherche
- Recherche full-text + fuzzy (Fuse.js) sur DB  
- Filtres par `theme`, local/remote  
- Chat basique : « montre-moi les repos nextjs » → liste filtrée

### 2.5 Backups
- Manuel ou cron  
- Options : par repo / par thème / tout  
- Format : git bundle ou zip  
- Destination : local (NAS) ou cloud (S3 / GitHub Releases)

### 2.6 Synchronisation multi-devices
- DB partagée (Supabase / SQLite cloud)  
- Champs synchronisés : SHA, theme, physicalPath relatif  
- Statut : synced / conflict / outdated  
- Alertes dashboard

## 3. Modèle de données clé (Prisma simplifié)

```prisma
model Repository {
  id             Int       @id @default(autoincrement())
  name           String
  remoteUrl      String?
  originalPath   String    // chemin lors découverte
  physicalPath   String?   // après triage
  theme          String?
  triageStatus   String?   // pending / manual / auto / ignored
  lastCommitSha  String?
  lastSyncAt     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}
```

## 4. Priorités de développement (roadmap v1.1)

1. Configuration (racine + thèmes)  
2. Scan + détection repos  
3. **Triage UI + déplacement sécurisé** ← MVP différenciant  
4. Dashboard + status  
5. Sync GitHub basique  
6. Recherche / chat minimal  
7. Backups simples  
8. Sync multi-devices (optionnel fin v1)

## 5. Contraintes & garde-fous

- Confirmation obligatoire avant tout déplacement (sauf mode auto explicite)  
- Logs + historique des moves (undo partiel possible)  
- Gestion WSL/Windows paths (normalisation)  
- Rate-limit GitHub API + caching agressif  
- Pas d’exécution de code arbitraire dans les repos
